## About

These packages contain the code for all main microservices, plus a few other miscellaneous services/features.

### `discord-relay`

_Runs on: ECS_

Has two main purposes:
1. Listen to specific Discord channels for anything matching command syntax (e.g. `!start someapp`) and invoke `command-service` to handle the command.
2. Provide a simplifed Discord API to other services, to send messages to users or channels and edit user permissions.

### `command-service`

_Runs on: ECS_

Handles commands submitted by `discord-relay`, usually by invoking the other relevant services. Invokes `workflows-handler` to handle commands that take too long to be handled synchronously.

Directly implements one-click (federated) terminal access to EC2 instances using SSM Session Manager.

### `workflows-handler`

_Runs on: Step Functions, Lambda_

Handles asynchronous/long-running workflows, e.g. deploying a new game, setting it up and shutting it down. Communicates with `app-daemon` directly on game/application EC2 instances, and sends messages in Discord to keep users up-to-date.

This is really just a set of Step Functions resources, not a service on its own.

### `game-metadata-service`

_Runs on: ECS_

Basic CRUD interface to interact with metadata for games/applications, including details on allocated AWS resources (e.g. SQS queues and EC2 instances).

### `network-security-service`

_Runs on: ECS_

Simplifies management of security groups for games/application EC2 instances. Maintains a standard user IP list and allows instance ports to be opened _only_ to addresses on this list.

Couples with `ip-authorizer` to allow authenticated Discord users to whitelist themselves via their browser.

Additionally, analyzes VPC flow logs to determine idleness/inactivity in game/application instances.

### `ip-authorizer`

_Runs on: API Gateway, Lambda_

The public API component of `network-security-service` needed to support IP authorization callback links. These are necessary since user IP addresses can't be directly obtained from Discord.

Captures requester IP addresses and callback tokens from an authorization request and relays them to `network-security-service`.

Will eventually be replaced with a CloudFront-hosted JS frontend to improve response time and user experience.  

### `url-shortener`

_Runs on: ECS_

URLs generated by the bot are often long and ugly, leading to bad UX since Discord highlights them when asking for user confirmation on navigation. This service provides URL shortening to make these less scary-looking.

Uses client-side encryption: internally, URLs are stored in an encrypted format using data keys encoded in the shortened URL. Even with access to the URL database, full URLs can't be viewed without the actual short URL.  

### `resource-reaper`

_Runs on: CloudWatch Events, Lambda_

Periodically runs cleanup tasks for unused resources. Currently only used to clean up temporary SQS queues created by `service-framework` for two-way messaging.
