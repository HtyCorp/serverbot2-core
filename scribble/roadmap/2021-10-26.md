## 2021-10-26 Roadmap Tasks (descending priority)

### Bring back Xray trace support

#### Complexity
Low

#### Impact
High ops impact, will improve understanding of command latency

#### Tasks
* Fix native-image incompatibility issues (mainly Apache Commons Logging usage)
* Add implementation in `XrayUtils`

### Improved UX for commands in Discord

#### Complexity
Medium

#### Impact
High UX impact, improves problematic rough edges on commands

#### Tasks
* Migrate commands (currently in CommandService) to a standard model package)
* Rework slash command registration to use model directly from relay code
* Replace DMs for private links with ephemeral messages
* Implement assisted flows using Discord message components for UI

### Create instance workflow service

#### Complexity
Medium

#### Impact
High ops impact in replacing existing hacky solution

#### Tasks
* Design new SFn flows with more decision branching and implement internally
* Expose state change APIs with strong consistency
* Use snapshots as game state source of truth (not EBS volumes as is the case now)
* Implement option for EC2 Spot usage
* Implement option for EBS volume preloading

### Improve web look and feel for IPAuth pages

#### Complexity
Low

#### Impact
Medium impact to UX as plain TXT on IP Auth is an eyesore. Unblocks auto-invoke onboarding later

#### Tasks
* Replace API-generated page with formatted static (scripted: JS/TS) CloudFront/S3 page
* Implement mini REST API for deferred post-load auth API call

### Multi-tenant bot

#### Complexity
High

#### Impact
Makes public launch possible, improves cost analysis

#### Tasks
* New service to securely fetch/cache customer credentials and audit access
* Figure out account onboarding flow (may be manual/CFN for now, but assisted would be nice in future)
* Rework DB schemas to make sense with multiple customers
* (Possibly) New service to store/manage customer details ('subscriptions'?)
* Rework service code to be aware of customer context
* New service based on IOT Core for bi-directional request/response to/from instances
* Migrate app-daemon to IOT Core (probably rename it too)
* Migrate to on-host firewall using nftables (replaces NetSec functionality)

### IPAuth auto-invoke with web push

#### Complexity
Medium

#### Impact
High UX improvement as it makes IP auth smoother, potentially even auto in some cases (e.g. on /start)

#### Tasks
* Investigate best way to store user preference and onboard status
* Implement mini SFn workflow to account for web push latency possibly pushing command invoke latency >3s
* Update /addip implementation to use new workflow
* Add onboarding option to IPAuth page

### Use on-host OS SFTP server instead of embedded app-daemon version

#### Complexity
Low

#### Impact
Medium ops impact, should mitigate excessive agent size

#### Tasks
* Investigate agent size reduction achieved by removing Apache MINA SSHD
* Implement mini custom PAM module for SFTP
* Update instance init to set up second OpenSSH sftp service
* Update agent SFTP logic to just manage second OS service
